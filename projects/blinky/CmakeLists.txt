
include(../../tools/cmake_files/gccFlags.cmake)

set(ASSEMBLY_FILES 
)

set(SOURCES 
        ../../xdk-asf-3.51.0/sam0/utils/cmsis/samd10/source/gcc/startup_samd10.c
        ../../xdk-asf-3.51.0/sam0/utils/cmsis/samd10/source/system_samd10.c
        main.cpp
)

set(INCLUDE_DIRS 
        ../../xdk-asf-3.51.0/common/utils/
        ../../xdk-asf-3.51.0/sam0/utils
        ../../xdk-asf-3.51.0/sam0/utils/cmsis/samd10/include
        ../../xdk-asf-3.51.0/sam0/utils/cmsis/samd10/source
        ../../xdk-asf-3.51.0/sam0/utils/header_files
        ../../xdk-asf-3.51.0/sam0/utils/preprocessor
        ../../xdk-asf-3.51.0/thirdparty/CMSIS/Include
        ../../xdk-asf-3.51.0/thirdparty/CMSIS/Lib/GCC 
        ../../xdk-asf-3.51.0/sam0/applications/led_toggle/samd10_xplained_mini/gcc
)

set(DEFINES -D__SAMD10C14A__)

set(CPU_FLAGS
        -mcpu=cortex-m0plus
)

set(FPU_FLAGS 
)

project(blinky)

set(EXECUTABLE blinky.elf)

add_executable(${EXECUTABLE} ${SOURCES} ${ASSEMBLY_FILES})


target_include_directories(${EXECUTABLE} PRIVATE ${INCLUDE_DIRS})
target_compile_definitions(${EXECUTABLE} PRIVATE ${DEFINES})

message(STATUS "Build Type = ${CMAKE_BUILD_TYPE}")

if( ${CMAKE_BUILD_TYPE} STREQUAL "Debug" )
target_compile_options(${EXECUTABLE} PRIVATE 
        #${CMAKE_CXX_FLAGS_DEBUG} 
        ${CPU_FLAGS} 
        ${FPU_FLAGS})

target_link_options(${EXECUTABLE} PRIVATE 
        #${CMAKE_EXE_LINKER_FLAGS_DEBUG} 
        ${CPU_FLAGS} 
        ${FPU_FLAGS} 
        -T ${CMAKE_SOURCE_DIR}/xdk-asf-3.51.0/sam0/utils/linker_scripts/samd10/gcc/samd10c14a_flash.ld)
else()
target_compile_options(${EXECUTABLE} PRIVATE 
        #${CMAKE_CXX_FLAGS_RELEASE} 
        ${CPU_FLAGS} 
        ${FPU_FLAGS})

target_link_options(${EXECUTABLE} PRIVATE 
        #${CMAKE_EXE_LINKER_FLAGS_RELEASE} 
        ${CPU_FLAGS} 
        ${FPU_FLAGS} 
        -T ${CMAKE_SOURCE_DIR}/xdk-asf-3.51.0/sam0/utils/linker_scripts/samd10/gcc/samd10c14a_flash.ld)
endif()


#target_link_libraries(blinky )

#make_list_dir("blinky")

#Optional: Print executable size as part of the post build process
#add_custom_command(TARGET ${EXECUTABLE}
#        POST_BUILD
#        COMMAND ${CMAKE_SIZE_UTIL} ${EXECUTABLE})

# Optional: Create hex, bin and S-Record files after the build
add_custom_command(TARGET ${EXECUTABLE}
        POST_BUILD
        COMMAND ${CMAKE_OBJCOPY} -O srec --srec-len=64 ${EXECUTABLE} ${PROJECT_NAME}.s19
        COMMAND ${CMAKE_OBJCOPY} -O ihex ${EXECUTABLE} ${PROJECT_NAME}.hex
        COMMAND ${CMAKE_OBJCOPY} -O binary ${EXECUTABLE} ${PROJECT_NAME}.bin)